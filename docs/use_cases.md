# Описание функционала сервиса

## Общее
Сервис позволяет автоматизировать рутинные задачи:
- с отслеживанием sla в чатах дежурств, напоминание о незакрытых обращениях
- с процессом ревью и оповещением по статусам МР, а так же напоминание о необходимости завершить ревью

## Общий модуль: Team
Через api методы позволяет создать команду и выпустить токен к ней в формате uuid. В последующем сущность team используется в качестве точки входа в разные флоу, т.е. является авторизацией для работы с сервисом

Какие операции доступны:
- получить список всех тимов (без авторизации)
- создать новую тиму (без авторизации)
- изменить (токен и id руководителя) существующую тиму (под авторизацией)
- удалить тиму (под авторизацией)

Команд может быть сколько угодно, ограничений на количество нет.

## Дежурства

### Методы для работы с конфигурацией чатов с дежурствами
Через api методы можно задавать конфигурации для взаимодействия с чатами

Что можно задать через конфигурацию:
- sla для первого контакта дежурного с обращением
- время через которое периодически будет повторно пушиться дежурный
- задать реакция(эмодзи) сигнализирующем о начале и завершения разбора обращения
- рабочие часы по мск

Какие операции доступны (под авторизацией: тима + токен):
- получить список всех чатов тимы с их конфигурацией
- создать новую конфигурацию под чат
- изменить конфигурацию
- удалить конфигурацию

### Bot дежурств для контроля SLA по обращениям в чатах
Выгружает посты из чатов ММ согласно заданным конфигурациям в таблице config_duty.
После проводит их обработку, откидывает лишние, записывает в posts_duty. 
Далее крон проходит по записям в posts_duty и пушит дежурных согласно TTL, 
но только в рабочее время, которое задается в config_duty.

Если пост(обращение) помечается соответствующим эмодзи (согласно config_duty), то пост больше не обрабатывается и удаляется из бд.

Если пост не разобран более чем за неделю, он перестает обрабатываться

## Gitlab

### Методы для работы с конфигурацией gitlab
Через api методы можно задавать конфигурации для настройки интеграции с gitlab

Что можно задать через конфигурацию:
- указать любой проект gitlab, в том числе на любом хосте
- различный SLA в зависимости от размера МР
- необходимость тега QA, если затрагивались авто тесты
- необходимость тега QA при мерже МР

Какие операции доступны (под авторизацией: тима + токен):
- получить список всех чатов тимы с их конфигурацией
- создать новую конфигурацию под чат
- изменить конфигурацию
- удалить конфигурацию

### Bot для автоматизации процессов работы с МР
По вебхуку получает информацию о МР и в зависимости от значений в config_gitlab для проекта формирует сообщение для отправки в ММ.
В сообщении указывает необходимое количество ревьюеров, тегает QA если задана соответствующая конфигурация требуется проверка автотестов.
Также указывается ссылка на МР, указывается его размер и SLA

### Повторные пуши
После корневого сообщения и призыва коллег на ревью, бот напомнит об открытом МР спустя истечения SLA.

Далее будет пушить в 15:00 по МСК каждый день с ПН по ПТ.

### Завершения жизненного цикла МР
Если МР влит, то отправляется сообщение о том что МР влит. Если указано в конфигурации, то тегается QA.

Если МР закрыт, то также отправляется сообщение в тред

После одного из этих действий сервис удаляет информацию о первоначальном сообщении о МР и не беспокоит
